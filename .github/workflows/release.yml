name: Release

on:
  push:
    branches:
      - main
      
permissions:
  contents: write
  pull-requests: write

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v5
        with:
          fetch-depth: 0
      # æ‰§è¡Œç¯å¢ƒ pnpm
      - name: Setup pnpm
        uses: pnpm/action-setup@v4

      # æ‰§è¡Œç¯å¢ƒ node
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: pnpm

      # æ‰§è¡Œç¯å¢ƒ dependencies
      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Create Release PR
        uses: changesets/action@v1
        with:
          publish: pnpm release
          # branch: release/main # æ§åˆ¶åˆ†æ”¯åå­—
        env:
          # è¿™æ˜¯ GitHub ç»™è¿™ä¸ª workflow çš„â€œä¸´æ—¶æœºå™¨äººæƒé™â€ GITHUB_TOKEN æ˜¯ğŸ‘‰ GitHub è‡ªåŠ¨ç»™çš„
          # æ¯æ¬¡ workflow è¿è¡Œéƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆ åªåœ¨è¿™ä¸ª workflow ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆ
          # changesets/action ä¼šå°è¯•ï¼šåˆ›å»ºåˆ†æ”¯ã€åˆ›å»º PRã€push commit
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
