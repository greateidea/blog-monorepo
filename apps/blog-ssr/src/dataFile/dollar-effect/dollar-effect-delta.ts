import { getSafeHtmlFromDelta } from "../../utils"

const TestDeltaString = {"ops":[{"attributes":{"bold":true},"insert":"React x Svelte"},{"insert":" è·¨ç•Œè”åŠ¨åˆæ¥å•¦ï¼éšç€å¯¹ "},{"attributes":{"bold":true},"insert":"svelte"},{"insert":" çš„äº†è§£è¶Šæ¥è¶Šæ·±å…¥ï¼Œè¶Šæ˜¯å‘ç° "},{"attributes":{"bold":true},"insert":"svelte"},{"insert":" çœŸçš„æŒºæœ‰æ„æ€ï¼Œå®ƒä»£è¡¨äº†"},{"attributes":{"bold":true},"insert":"ä¸‹ä¸€ä»£å‰ç«¯æ¡†æ¶"},{"insert":"ï¼Œæœ‰ç€è‡ªå·±ç‹¬ç‰¹çš„ç†å¿µå’Œè¿è¡Œæ–¹å¼ï¼Œå¹¶ä¸”è¡¨ç°çš„å¾ˆå¥½ã€‚åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å®Œæˆäº†"},{"attributes":{"link":"https://blog.hiou.top/dollar-state"},"insert":"$steteåœ¨Reacä¸­çš„å®ç°"},{"insert":"ï¼Œè€Œè¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬ç»§ç»­å°† svelte ä¸­çš„å¦ä¸€ä¸ªé‡è¦çš„ "},{"insert":{"blue700-tag":{"id":1763541805671,"text":"rune:$effect","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" å¼•å…¥ Reactã€‚å¦‚æœä½ å·²ç»è¯»è¿‡ä¹‹å‰çš„ "},{"attributes":{"link":"https://blog.hiou.top/dollar-state"},"insert":"sevlteçš„$steteåœ¨Reacä¸­çš„å®ç°è¿™ç¯‡æ–‡ç« "},{"insert":"ï¼Œé‚£ä¹ˆä½ å°†ä¼šå¾ˆè½»æ¾çš„ç†è§£æ¥ä¸‹æ¥å†…å®¹ã€‚\n\nä½ è‚¯å®šå‘ç°æˆ‘ä½¿ç”¨äº†ä¸€ä¸ªæ–°è¯å„¿ "},{"insert":{"blue700-tag":{"id":1763542255086,"text":"rune","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":"ï¼Œè¿™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªè¢« svelte ç§°ä¹‹ä¸ºâ€œ"},{"attributes":{"bold":true},"insert":"å“åº”å¼åŸè¯­"},{"insert":"â€ï¼Œè¿™ä¹ˆè¯´ä½ è‚¯å®šè¿˜æ˜¯è§‰å¾—å¾ˆæŠ½è±¡ã€‚ç®€å•æ¥è¯´ï¼Œsvelte ä¸­çš„"},{"attributes":{"bold":true},"insert":" $stated"},{"insert":"ã€"},{"attributes":{"bold":true},"insert":"$effect"},{"insert":"éƒ½æ˜¯ "},{"insert":{"blue700-tag":{"id":1763542284400,"text":"rune","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":"ï¼Œé™¤æ­¤ä¹‹å¤– svelte è¿˜æœ‰å¾ˆå¤šè¿™ç§ â€œ"},{"attributes":{"bold":true},"insert":"åŸè¯­"},{"insert":"â€ï¼Œæ¯”å¦‚ï¼š"},{"attributes":{"bold":true},"insert":"$derived"},{"insert":"ã€"},{"attributes":{"bold":true},"insert":"$props"},{"insert":"ã€"},{"attributes":{"bold":true},"insert":"$inspect"},{"insert":"ã€"},{"attributes":{"bold":true},"insert":"$template "},{"insert":"ç­‰ç­‰ã€‚è¿™äº›â€œ"},{"attributes":{"bold":true},"insert":"åŸè¯­"},{"insert":"â€åˆ›å»ºçš„å˜é‡è¢«ç§°ä¹‹ä¸ºâ€œ"},{"attributes":{"bold":true},"insert":"å“åº”å¼å˜é‡"},{"insert":"â€ã€‚\n\nä½ åˆä¼šå‘ç°ï¼Œæˆ‘ä»¬å¼€å§‹ä»‹ç»ä¸€äº›"},{"attributes":{"bold":true},"insert":"æ–°æ¦‚å¿µ"},{"insert":"äº†ã€‚ä¸è¦ç€æ€¥ï¼Œæˆ‘ä»¬å…ˆè€å¿ƒææ‡‚è¿™äº› svelte çš„æ¦‚å¿µï¼Œæ¥ä¸‹æ¥çš„å†…å®¹é˜…è¯»èµ·æ¥æ‰ä¼šæ›´æ¸…æ™°ã€‚å› ä¸ºéšç€å¯¹ svelte çš„æ·±å…¥äº†è§£ï¼Œæˆ‘ä»¬çš„çŸ¥è¯†å·²ç»è§¦åŠåˆ° svelte çš„æ ¸å¿ƒç†å¿µï¼Œæ­¤æ—¶æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä»ä»£ç å¼€å§‹ï¼Œè€Œæ˜¯è¦å…ˆç†è§£å®ƒçš„è®¾è®¡ç†å¿µå’Œè¿è¡Œæ–¹å¼ï¼Œå†æŒ‰å›¾ç´¢éª¥ï¼Œäº‹åŠåŠŸå€ï¼å°±åƒä¸€ç›˜ç¾å‘³æ‘†åœ¨ä½ é¢å‰ï¼Œå¦‚æœä½ ç›´æ¥å¡è¿›å˜´é‡Œï¼Œå´æƒ³ä¸ç»å’€åš¼å¤§å£åä¸‹ï¼Œé‚£ä¹ˆç»“æœå°±æ˜¯æ—¢å°ä¸åˆ°å£ä¸­ç¾å‘³ï¼Œåˆéš¾ä»¥ä¸‹å’½ï¼Œæ­¤æ—¶åˆéš¾ä»¥å’€åš¼ï¼Œå°±æ˜¯è¿™ä¸ªé“ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¼€å§‹å§ï¼\n\nsvelteå“åº”å¼ç³»ç»Ÿ"},{"attributes":{"header":2},"insert":"\n"},{"insert":"svelteé€šè¿‡"},{"attributes":{"bold":true},"insert":"å“åº”å¼åŸè¯­"},{"insert":"å’Œ"},{"attributes":{"bold":true},"insert":"å“åº”å¼å˜é‡"},{"insert":"æ„å»ºäº†ä¸€å¥—å®Œæ•´çš„"},{"attributes":{"bold":true},"insert":"å“åº”å¼ç³»ç»Ÿã€‚"},{"insert":"è¿™å¥—ç³»ç»Ÿçš„åŸºæœ¬è¿è¡Œé€»è¾‘å°±æ˜¯ï¼Œå½“è¿™äº›å˜é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¯¹åº”è®¿é—®è¿™äº›å˜é‡çš„éƒ¨åˆ†ï¼ˆdomã€$effectã€$derived etc.ï¼‰ä¹Ÿä¼šéšç€æ›´æ–°å’Œæ‰§è¡Œï¼Œå¹¶ä¸”åªæœ‰è‡ªå·±æ‰ä¼šæ›´æ–°ä¸ä¼šå½±å“å…¶å®ƒéƒ¨åˆ†ã€‚\n\nä¸¾ä¸ªUIæ›´æ–°çš„ä¾‹å­å¯¹æ¯”ï¼šReact çš„æ¸²æŸ“åŸºæœ¬å•ä½æ˜¯ä»¥ç»„ä»¶ä¸ºå•ä½ã€‚ç»„ä»¶é‡Œä»»æ„ "},{"attributes":{"bold":true},"insert":"state"},{"insert":" å†…ä¸€ä¸ªå€¼å‘ç”Ÿå˜åŒ–ä½ éƒ½è¦æ›´"},{"attributes":{"bold":true},"insert":"æ–°æ•´ä¸ª state "},{"insert":"è¿›è€Œ"},{"attributes":{"bold":true},"insert":"æ•´ä¸ªç»„ä»¶"},{"insert":"ã€‚è€Œåœ¨ svelte é‡Œï¼Œæ²¡æœ‰è™šæ‹Ÿ Domï¼Œä»£ç ç»è¿‡ç¼–è¯‘åï¼Œæ‰€æœ‰çš„æ ‡ç­¾éƒ½è¢«ç›´æ¥è½¬åŒ–ä¸º "},{"attributes":{"bold":true},"insert":"dom"},{"insert":" å’Œ "},{"attributes":{"bold":true},"insert":"å¯¹domçš„è®¿é—®ä¸æ“ä½œ"},{"insert":"ã€‚æ­¤æ—¶å“åº”å¼å˜é‡å¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆè®¿é—®äº†è¯¥å˜é‡çš„ dom å°±ä¼šæ›´æ–°å…¶å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œsvelte çš„UIæ›´æ–°æ˜¯"},{"insert":{"blue700-tag":{"id":1763542617504,"text":"ç²¾å‡†çš„ dom æ“ä½œ","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":"ã€‚\n\nå›åˆ° "},{"insert":{"blue700-tag":{"id":1763542944155,"text":"$effect","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" ä½œä¸ºè¿™ä¸ªç³»ç»Ÿçš„é‡è¦å‚ä¸è€…ï¼Œå®ƒæ˜¯æ€ä¹ˆå‘æŒ¥ä½œç”¨çš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆä»äº†è§£å…¶åŸºæœ¬ä½¿ç”¨æ–¹æ³•å¼€å§‹ï¼š\n<script>"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  let count = $state(0);"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"  $effect(() => {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    console.log(count)"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"    return () => {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"      console.log(\"teardown function\")"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    };"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  });"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"</script>"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"<h1>{count}</h1>"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"<button onclick={() => (count *= 2)}>count *= 2</button>"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"è¿™æ®µä»£ç çš„æ•ˆæœæ˜¯ï¼šä½¿ç”¨ "},{"attributes":{"bold":true},"insert":"$effect"},{"insert":" æ³¨å†Œäº†ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å’Œ "},{"attributes":{"bold":true},"insert":"h1 æ ‡ç­¾"},{"insert":"è®¿é—®äº†ä¸€ä¸ªå“åº”å¼å˜é‡ "},{"attributes":{"bold":true},"insert":"count"},{"insert":"ã€‚é¡µé¢æ¸²æŸ“æ—¶æ³¨å†Œå‡½æ•°ä¼šç«‹å³æ‰§è¡Œä¸€æ¬¡ã€‚\n\nç‚¹å‡»æŒ‰é’®ä¼šå¯¹è¿™ä¸ª "},{"attributes":{"bold":true},"insert":"count"},{"insert":" è¿›è¡Œè‡ªåŠ èµ‹å€¼ï¼Œè¿›è€Œ "},{"attributes":{"bold":true},"insert":"$effect"},{"insert":" å†…è¿”å›çš„å‡½æ•°ä¼šå…ˆæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åæ³¨å†Œçš„è¿™ä¸ªå‡½æ•°ä¼šæ‰§è¡Œå¹¶æ‰“å°å˜é‡å€¼ï¼Œh1 æ ‡ç­¾å¯¹åº”çš„ dom æ›´æ–°ã€‚\n\nä½ ä¼šæ³¨æ„åˆ°è¿™ä¸ª"},{"insert":{"blue700-tag":{"id":1763542892426,"text":" $effect","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" å’Œ React çš„ "},{"attributes":{"bold":true},"insert":"useEffect"},{"insert":" ç›¸ä¼¼ä½†åˆä¸åŒï¼Œä¸åŒçš„é‡ç‚¹å…¶å®å°±æ˜¯ï¼Œå®ƒä¸éœ€è¦ä½ æ˜¾ç¤ºçš„åœ¨å‚æ•°åˆ—è¡¨é‡Œåˆ—å‡ºä¾èµ–é¡¹ï¼Œè€Œæ˜¯è‡ªåŠ¨å°†æ³¨å†Œçš„å‡½æ•°å†…ï¼Œè®¿é—®çš„å“åº”å¼å˜é‡ï¼Œä½œä¸ºä¾èµ–ã€‚\n\n$effectå¦‚ä½•å¾—çŸ¥å®ƒçš„ä¾èµ–"},{"attributes":{"header":2},"insert":"\n"},{"insert":"è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„ç°è±¡ï¼Œ"},{"insert":{"blue700-tag":{"id":1763542950803,"text":"$effect","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" æ˜¯å¦‚ä½•å¾—çŸ¥ï¼Œä½¿ç”¨å®ƒæ³¨å†Œçš„å‡½æ•°é‡Œé¢ï¼Œè®¿é—®äº†å“ªäº›å“åº”å¼å˜é‡å‘¢ï¼Ÿç­”æ¡ˆå…¶å®å¯èƒ½æ¯”ä½ æƒ³çš„è¦ç®€å•ï¼Œå°±å¦‚åŒâ€œ"},{"insert":{"blue700-tag":{"id":1763542974736,"text":"é«˜ç«¯çš„é£Ÿæå¾€å¾€åªéœ€è¦æœ€ç®€å•çš„çƒ¹é¥ªæ–¹å¼","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":"â€ã€‚\n\næˆ‘ä»¬è¿˜æ˜¯ä»¥ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸ºä¾‹ï¼š\nå½“ "},{"insert":{"blue700-tag":{"id":1763542950803,"text":"$effect","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" æ‰§è¡Œçš„æ—¶å€™ï¼Œå…ˆç«‹é©¬å‘"},{"attributes":{"bold":true},"insert":"å…¨å±€"},{"insert":"çš„æŸä¸€ä¸ªå˜é‡è®¾ç½®ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼è‡³å°‘åŒ…å«äº†è‡ªå·±èº«çš„å¼•ç”¨ã€‚ç„¶åæ‰§è¡Œæ³¨å†Œçš„å‡½æ•°ï¼Œæ³¨å†Œå‡½æ•°å†…çš„consoleè¯­å¥è®¿é—®äº†count å˜é‡ï¼Œæ­¤æ—¶å¦‚æœ count å˜é‡å¯ä»¥è¿›è¡Œ"},{"attributes":{"bold":true},"insert":"è®¿é—®æ‹¦æˆª"},{"insert":"ï¼Œé‚£ä¹ˆæ‹¦æˆªçš„æ—¶å€™å°±å¯ä»¥å»é‚£ä¸ªå…¨å±€å˜é‡å–å‡ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„ "},{"insert":{"blue700-tag":{"id":1763542950803,"text":"$effect","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":"ã€‚å¥½çš„ï¼Œåˆ°äº†è¿™é‡Œä½ ä¼šå‘ç°ï¼Œè¢«è®¿é—® count å…¶å®æ˜¯å¯ä»¥é€šè¿‡é‚£ä¸ªå…¨å±€å˜é‡ï¼ŒçŸ¥é“è‡ªå·±å½“å‰åœ¨å“ªä¸ª effect å†…è¢«è®¿é—®çš„ï¼Œå¦‚æœé‚£ä¸ªå…¨å±€å˜é‡é‡Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è®°å½•ä¿å­˜å“åº”å¼å˜é‡çš„å‘¢ï¼Ÿå“‡ï¼æˆ‘çŒœä½ ä¸€å®šè±ç„¶å¼€æœ—äº†ï¼Œçˆ½ï¼\n\nä¹Ÿå°±æ˜¯è¯´ "},{"insert":{"blue700-tag":{"id":1763542950803,"text":"$effect","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" çš„ä¾èµ–ä¸æ˜¯è‡ªå·±ä¸»åŠ¨å»æ‰¾åˆ°çš„ï¼Œè€Œæ˜¯æ³¨å†Œçš„å‡½æ•°å†…ï¼Œè®¿é—®çš„å“åº”å¼å˜é‡è‡ªå·±â€œä¸»åŠ¨äº¤ä»£â€çš„ï¼count è¢«è®¿é—®çš„æ—¶å€™ï¼Œé€šè¿‡ä¸€ä¸ªå…¨å±€å˜é‡å¾—çŸ¥è‡ªå·±å½“å‰åœ¨å“ªä¸ª effect å†…è¢«è®¿é—®ï¼Œç„¶åä¸»åŠ¨æŠŠè‡ªå·±åŠ å…¥è¿™ä¸ªeffectå¯¹åº”çš„ä¾èµ–åˆ—è¡¨é‡Œï¼æ­¤æ—¶ï¼Œcount å˜é‡è¿˜å¯ä»¥å°†å½“å‰è¿™ä¸ª effect åŠ å…¥è‡ªå·±çš„"},{"attributes":{"bold":true},"insert":"è®¢é˜…è€…åˆ—è¡¨"},{"insert":"é‡Œã€‚\n\nè¿›ä¸€æ­¥ï¼Œå¦‚æœ count è¿˜å¯ä»¥åš"},{"attributes":{"bold":true},"insert":"èµ‹å€¼æ‹¦æˆª"},{"insert":"ï¼Œé‚£ä¹ˆè¢«èµ‹å€¼æ›´æ–°çš„æ—¶å€™ï¼Œå²‚ä¸å°±å¯ä»¥é€šè¿‡è‡ªå·±çš„"},{"attributes":{"bold":true},"insert":"è®¢é˜…è€…åˆ—è¡¨"},{"insert":"ï¼Œé€šçŸ¥æ‰€æœ‰è®¢é˜…è€…äº†ï¼åŸæ¥è¿™ä¹ˆç®€å•ï¼\n\neffectåŸºç¡€æµç¨‹"},{"attributes":{"header":2},"insert":"\n"},{"insert":"åˆ°äº†è¿™ä½ å¯èƒ½æ¿€åŠ¨çš„æƒ³è¦çœ‹çœ‹å…·ä½“æ€ä¹ˆå®ç°çš„äº†ï¼Œä¸è¦ç€æ€¥ï¼Œå’±ä»¬ä¸€æ­¥ä¸€æ­¥æ¥ã€‚è¿™åªæ˜¯æœ€åŸå§‹çš„é€»è¾‘ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸ºè¿™ä¸ªé€»è¾‘è¡¥å……ä¸€äº›æµç¨‹ä¸Šçš„ç»†èŠ‚ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸€ç§æƒ…å†µï¼š\nlet condition = $state(false);"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"let value = $state(0);"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"$effect(() => {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  if (condition) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    console.log(value); // ä¾èµ– value"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  }"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  // å¦‚æœconditionå˜ä¸ºfalseï¼Œvalueçš„ä¾èµ–åº”è¯¥è¢«æ¸…é™¤"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"});"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"å¦‚æœæˆ‘ä»¬æ¯æ¬¡å»ºç«‹ä¾èµ–å…³ç³»å‰ï¼Œä¸å…ˆæ¸…ç†ä¾èµ–ï¼Œå½“ "},{"attributes":{"bold":true},"insert":"condition"},{"insert":" ä¸º "},{"attributes":{"bold":true},"insert":"false"},{"insert":" æ—¶ï¼Œ"},{"attributes":{"bold":true},"insert":"value"},{"insert":" çš„å˜åŒ–ä»ç„¶ä¼šè§¦å‘ effectï¼Œè¿™ç§æƒ…å†µæ˜¾ç„¶é”™è¯¯çš„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œ"},{"attributes":{"bold":true},"insert":"æ‚¬æŒ‚ä¾èµ–"},{"insert":"â€ã€‚åŒæ—¶é‡Œé¢æŸäº›å“åº”å¼å˜é‡å¯èƒ½ä¼šåœ¨æŸäº›æƒ…å†µç³»å·²ç»è¢«é”€æ¯äº†ï¼Œä¹Ÿä¸åº”è¯¥åšè®°å½•ï¼Œä¸ºäº†é¿å…è¿‡å¤šçš„è¾¹ç•Œæƒ…å†µï¼Œä¿æŒæ¯æ¬¡çš„ä¾èµ–æ˜¯å¹²å‡€æ¸…æ™°çš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å»ºç«‹ä¾èµ–å‰å…ˆå½»åº•æ¸…ç†æ‰åŒæ–¹çš„ä¾èµ–è®¢é˜…å…³ç³»ï¼Œæ­£æ‰€è°“â€œæ—§çš„ä¸å»ï¼Œæ–°çš„ä¸æ¥â€ã€‚\n\nä½ å¯èƒ½ä¼šé—®ï¼Œæ€ä¿è¯ï¼Œæ¯æ¬¡åœ¨è¿™ä¸ªè®¾ç½®äº† effect çš„å…¨å±€å˜é‡æœŸé—´ï¼Œè®¿é—®çš„å“åº”å¼å˜é‡å°±æ˜¯è¿™ä¸ª effect çš„ä¾èµ–å‘¢ï¼ŒåŸå› è¿˜æ˜¯éå¸¸çš„è´¨æœ´ï¼Œå› ä¸º js æ˜¯å•çº¿ç¨‹çš„ã€‚\n\nç°åœ¨æˆ‘ä»¬é‡æ–°æ•´ç†ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š\n"},{"insert":{"listItemContainer":"<div class=\"list-item-container\" id=\"your-custom-id-123\"><div class=\"line-container\"><span class=\"list-index\">1. </span><span class=\"list-content\">$effectæ‰§è¡Œï¼Œè®¾ç½®å…¨å±€å˜é‡</span></div><div class=\"line-container\"><span class=\"list-index\">2. </span><span class=\"list-content\">æ¸…ç†åŒæ–¹çš„ä¾èµ–è®¢é˜…å…³ç³»</span></div><div class=\"line-container\"><span class=\"list-index\">3. </span><span class=\"list-content\">æ‰§è¡Œæ³¨å†Œå‡½æ•°ä¸Šæ¬¡æ‰§è¡Œåè¿”å›çš„å‡½æ•°</span></div><div class=\"line-container\"><span class=\"list-index\">4. </span><span class=\"list-content\">æ‰§è¡Œæ³¨å†Œå‡½æ•°ï¼Œåœ¨æ¯æ¬¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé¦–æ¬¡æˆ–é‡æ–°å»ºç«‹åŒæ–¹çš„ä¾èµ–è®¢é˜…å…³ç³»</span></div><div class=\"line-container\"><span class=\"list-index\">5. </span><span class=\"list-content\">ç§»é™¤å…¨å±€å˜é‡ä¸­è®¾ç½®çš„å€¼</span></div></div>"}},{"insert":"\neffectæ‰§è¡Œåˆ†æ"},{"attributes":{"header":2},"insert":"\n"},{"insert":"å¥½äº†ï¼Œæœ‰äº†ä»¥ä¸Šçš„é€»è¾‘ï¼Œå’±ä»¬å°±å¯ä»¥å¼€å§‹æŒ‰ç ç´¢éª¥ï¼š\nexport type RunnerType = {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    (): void;"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    __run: Function;"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    deps: Set<RunnerDepsType>;"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    cleanup: Function | null | never;"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    stop: Function;"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    running: boolean;"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"}"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"type RunnerDepsType = {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    _subs: Set<RunnerType>"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"}"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"type EffectFnResult = Function | null | never | void"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"type EffectFn = () => EffectFnResult"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"let RUNNER_STACK: RunnerType[] = []"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"export const getCurrentRunner = () => RUNNER_STACK[RUNNER_STACK.length - 1]"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"function pushRunner(runner: RunnerType) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    RUNNER_STACK.push(runner)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"}"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  "},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"// helper: safely pop runner and validate it's the same one"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"function popRunnerExpect(runner: RunnerType) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    const topRunner = RUNNER_STACK[RUNNER_STACK.length - 1]"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    if (topRunner === runner) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        RUNNER_STACK.pop()"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        return"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    } else if (RUNNER_STACK.length > 0) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        // use splice to keep the original variable reference unchanged"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        const runnerIndex = RUNNER_STACK.findIndex(r => r === runner)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        RUNNER_STACK.splice(runnerIndex, 1)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        // throw new Error(\"sync pop runner error\")"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"}"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  "},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"function makeRunner(fn: EffectFn): RunnerType {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    function runner() {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        // Clean previous deps: remove runner from each previous signal's subs"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        runner._cleanupDependencies()"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    "},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        // Enter runner global context"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        pushRunner(runner)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        try {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            (runner.cleanup as EffectFnResult) = fn(); // rebuild dependencies"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            runner.running = false;"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        } finally {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            popRunnerExpect(runner)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        }"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"    runner.running = false"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    runner.stopped = false"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    runner.cleanup = null"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    runner.deps = new Set<RunnerDepsType>()"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  "},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    // wrapped version used by scheduler to ensure no direct external calls bypassing __run"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    runner.__run = function() {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"      if (runner.stopped) return"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"      if (!runner.running) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            runner.running = true // merge all execution requests during this period before the actual start"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            queueMicrotask(() => {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"                if (runner.running) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"                    runner();"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"                }"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            });"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        }"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"javascript"},"insert":"\n\n\n"},{"insert":"    runner._cleanupDependencies = () => {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        for (const sig of runner.deps) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            sig._subs.delete(runner)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        }"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        runner.deps.clear()"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"        "},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        if (runner.cleanup) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            (runner.cleanup as Function)()"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            runner.cleanup = null"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        }"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  "},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    runner.stop = function() {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"      // remove from current dependencies"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"      for (const sig of runner.deps) sig._subs.delete(runner)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"      runner.deps.clear()"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"      runner.stopped = true"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    };"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  "},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    return runner"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"}"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  "},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"export function effect(fn: EffectFn) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    // pop all runners which in stack if it is in a effect context"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    if (RUNNER_STACK.length) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        var _copy_runner_stack = RUNNER_STACK.splice(0)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        fn()"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        RUNNER_STACK.push(..._copy_runner_stack)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        return"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"    const r = makeRunner(fn)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    // initial sync run to collect deps"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    r()"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    // return stop"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    return () => r.stop()"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"}"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"ä»£ç çœ‹èµ·æ¥æœ‰äº›é•¿ï¼Œä½†å®é™…ä¸Šå°±æ˜¯å¯¹ä»¥ä¸Šè¿‡ç¨‹çš„ç›´è§‚å¤ç°ã€‚æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼šæˆ‘ä»¬é¦–å…ˆç›´æ¥å®šä½åˆ° "},{"insert":{"blue700-tag":{"id":1763545246632,"text":"makeRunner","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" è¿™ä¸ªå‡½æ•°ï¼Œå®ƒè´Ÿè´£çš„å°±æ˜¯è¿”å›ä¸€ä¸ªçœŸæ­£æ‰§è¡Œ effect è¿‡ç¨‹çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œå®Œæˆäº†æˆ‘ä»¬ä»¥ä¸Šæåˆ°çš„æµç¨‹ã€‚\n\nåŒæ—¶æˆ‘ä»¬ç›´æ¥å°† effcet çš„çŠ¶æ€ã€ä¸€äº›æ–¹æ³•ã€ä¾èµ–é›†åˆæŒ‚åœ¨è¿™ä¸ªå‡½æ•°ä¸Šï¼Œå› æ­¤è¿™ä¸ªå‡½æ•°å°±å®Œå…¨ä»£è¡¨äº†å½“å‰è¿™ä¸ª effect æ¯”å¦‚ "},{"attributes":{"bold":true},"insert":"running"},{"insert":" è¡¨ç¤ºè¿™ä¸ªå‡½æ•°å·²ç»è¿›å…¥æ‰§è¡Œæµç¨‹ã€"},{"attributes":{"bold":true},"insert":"deps"},{"insert":" è¡¨ç¤ºä¾èµ–é›†åˆï¼ˆé‡Œé¢å­˜å‚¨è¿™å®ƒä¾èµ–çš„å“åº”å¼å˜é‡ï¼‰ã€"},{"attributes":{"bold":true},"insert":"cleanup"},{"insert":" è¡¨ç¤ºæ³¨å†Œå‡½æ•°è¿”å›çš„å‡½æ•°ã€‚\n\nåœ¨è¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æˆ‘ä»¬ä½¿ç”¨äº†"},{"attributes":{"bold":true},"insert":"å…¨å±€"},{"insert":"çš„æ ˆæ¥å¼¹å…¥å¼¹å‡ºå½“å‰effectï¼Œè¿™ä¸ª effect å°±æ˜¯ "},{"attributes":{"bold":true},"insert":"makeRunner"},{"insert":" è¿”å›çš„è¿™ä¸ªå‡½æ•°æœ¬èº«çš„å¼•ç”¨ï¼Œå®ƒä¾èµ–çš„å“åº”å¼å˜é‡ä¼šå°†å®ƒåŠ å…¥è‡ªå·±çš„è®¢é˜…è€…åˆ—è¡¨é‡Œã€‚\n\nåŒæ—¶å®ƒè¿˜æä¾›äº†ä¸€ä¸ª___runæ–¹æ³•ï¼Œå½“ä¾èµ–å˜é‡æ›´æ–°æ—¶å°±è°ƒç”¨è¿™ä¸ªæ–¹æ³•è§¦å‘effectæ‰§è¡Œã€‚ä½ å¯ä»¥çœ‹åˆ°å®ƒå¹¶æ²¡æœ‰ç›´æ¥æ‰§è¡Œï¼Œè€Œæ˜¯é€šè¿‡ "},{"insert":{"blue700-tag":{"id":1763543828668,"text":"queueMicroStack","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" å°†è¿™æ¬¡çš„ä»»åŠ¡æ¨å…¥åˆ°å½“å‰çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç›¸æ¯” "},{"attributes":{"bold":true},"insert":"Promise"},{"insert":" æ›´ç›´æ¥ï¼Œè¿™ä¹Ÿæ˜¯ "},{"attributes":{"bold":true},"insert":"React"},{"insert":" ä½¿ç”¨çš„å¼‚æ­¥ä»»åŠ¡æ–¹å¼ä¹‹ä¸€ã€‚\n\n"},{"attributes":{"bold":true},"insert":"_cleanupDependencies"},{"insert":" åˆ™æ˜¯æ¸…ç†ä¸Šæ¬¡åŒæ–¹å»ºç«‹çš„ä¾èµ–è®¢é˜…å…³ç³»ï¼Œå®ƒé¦–å…ˆä»"},{"attributes":{"bold":true},"insert":"ä¾èµ–åˆ—è¡¨é‡Œ"},{"insert":"å–å‡ºä¾èµ–å˜é‡ï¼Œä¾èµ–å˜é‡ç›´æ¥æä¾›äº†ä¸€ä¸ªè‡ªå·±çš„è®¢é˜…è€…åˆ—è¡¨ "},{"attributes":{"bold":true},"insert":"_subs"},{"insert":"ï¼Œç„¶å "},{"attributes":{"bold":true},"insert":"effect"},{"insert":" å°†è‡ªå·±ä»è¿™ä¸ªè®¢é˜…è€…åˆ—è¡¨ç§»é™¤ï¼Œæœ€åæ¸…ç©ºè‡ªå·±çš„ä¾èµ–åˆ—è¡¨ï¼ŒåŒæ–¹ä¸Šæ¬¡çš„æ©æ€¨çº è‘›å°±æ­¤äº†ç»“ã€‚\n\næˆ‘ä»¬è¿˜è¦æ³¨æ„ä¸€ä¸ªç»†èŠ‚ï¼Œé‚£å°±æ˜¯çŠ¶æ€ "},{"attributes":{"bold":true},"insert":"Running"},{"insert":"ï¼Œå®ƒå®é™…ä¸Šèµ·åˆ°äº†éå¸¸é‡è¦çš„ä½œç”¨ï¼Œä¸€æ—¦è¢«æ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—å°±ï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å°±ä¸å†æ¥å—é‡å¤çš„æ¨å…¥ä»»åŠ¡ã€‚è¿™å°±ç›¸å½“äºå°†è¿™ä¹‹å‰æ‰€æœ‰çš„æ›´æ–°æ‰§è¡Œè¯·æ±‚éƒ½åˆå¹¶äº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºåœ¨è¿™ä¹‹å‰å˜é‡å·²ç»æ›´æ–°äº†ï¼Œé‚£ä¹ˆè¿™æ¬¡æ‰§è¡Œå°±ä¼šè®¿é—®åˆ°å˜é‡çš„æœ€æ–°å€¼ï¼Œåœ¨è¿™æœŸé—´æ‰€æœ‰çš„å˜é‡æ›´æ–°æ‰§è¡Œè¯·æ±‚å…¶å®éƒ½æ˜¯é‡å¤çš„ï¼Œä¸¾ä¸ªç›´è§‚çš„ä¾‹å­ï¼šä½ æ¥æ”¶åˆ°ç¬¬ä¸€ä¸ªå«ä½ èµ·è·‘çš„æŒ‡ä»¤ï¼Œå¹¶å°†åœ¨3ç§’åèµ·è·‘ï¼ŒæŒ‡æœŸé—´å‰©ä½™æ‰€æœ‰çš„èµ·è·‘æŒ‡ä»¤éƒ½æ˜¯å·²ç»æ˜¯é‡å¤çš„äº†ã€‚\n\næ¥ä¸‹æ¥å°†æ³¨æ„åŠ›è½¬ç§»åˆ°effectå‡½æ•°ï¼Œå°±æ˜¯å®ƒè´Ÿè´£è°ƒç”¨ "},{"attributes":{"bold":true},"insert":"makeRunner "},{"insert":"æ¥åˆ›å»ºæ­¤æ¬¡çš„ effect ä»»åŠ¡ï¼Œå¹¶ä¸”ä¸ºäº†"},{"attributes":{"bold":true},"insert":"é¿å…åµŒå¥—"},{"insert":"ï¼Œå®ƒä¹Ÿå°†è¯»å–å…¨å±€çš„effectè®°å½•æ ˆæ¥åˆ¤æ–­å½“å‰æ‰§è¡Œæ˜¯å¦å¤„åœ¨ä¸€ä¸ª effect ä¸­ï¼Œå¦‚æœæ˜¯åˆ™ç›´æ¥å¼¹å‡º "},{"attributes":{"bold":true},"insert":"effectæ ˆ "},{"insert":"å†…æ‰€æœ‰å†…å®¹ï¼Œåœ¨æ‰§è¡Œä¸€æ¬¡æ³¨å†Œå‡½æ•°ï¼Œ"},{"attributes":{"italic":true,"bold":true},"insert":"é¿å…åœ¨è¿™æ¬¡æ‰§è¡Œä¸­å»ºç«‹ä¾èµ–å…³ç³»"},{"insert":"ï¼Œåªå½“å°†æ³¨å†Œå‡½æ•°å½“ä½œä¸€ä¸ªæ™®é€šå‡½æ•°æ‰§è¡Œï¼Œæ‰§è¡Œå®Œåæ¥ç€æ¢å¤æ ˆæ‰€æœ‰å†…å®¹ã€‚\n\nè¿˜éœ€è¦æ³¨æ„ä¸€ä¸ªç»†èŠ‚ï¼Œé‚£å°±æ˜¯æ¯æ¬¡å¯¹å…¨å±€æ ˆçš„æ“ä½œä½¿ç”¨äº†"},{"attributes":{"bold":true},"insert":"splice"},{"insert":"ã€"},{"attributes":{"bold":true},"insert":"pop"},{"insert":"ã€"},{"attributes":{"bold":true},"insert":"push"},{"insert":"ï¼Œå®ƒä»¬æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯ä¿æŒ"},{"attributes":{"bold":true},"insert":"å½“å‰yå¼•ç”¨ä¸å˜"},{"insert":"ã€‚\n\nå°†$effectå¼•å…¥Reactä¸–ç•Œ"},{"attributes":{"header":2},"insert":"\n"},{"insert":"å¦‚ä¹‹å‰"},{"attributes":{"link":"https://blog.hiou.top/dollar-state"},"insert":"$steteåœ¨Reacä¸­çš„å®ç°"},{"insert":"ä¸­ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨ React å¼•å…¥ "},{"insert":{"blue700-tag":{"id":1763545273529,"text":"$effect","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" æœ¬è´¨ä¸Šä»æ˜¯å®ç°ä¸€ä¸ª "},{"attributes":{"bold":true},"insert":"React Hook"},{"insert":"ï¼Œå› æ­¤ï¼š\nexport const $effect = (fn: EffectFn) => {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    let __fn_ref = useRef<EffectFn>(null);"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    if (!__fn_ref.current) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        __fn_ref.current = fn"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        effect(__fn_ref.current)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"}"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"å› æ­¤æˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨ç›¸åŒçš„æ‰‹æ³•ï¼Œå°† "},{"insert":{"blue700-tag":{"id":1763544294010,"text":"$effect","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" å¼•å…¥ "},{"attributes":{"bold":true},"insert":"React"},{"insert":"ã€‚\n\nå¥½äº†ï¼Œèƒ½è¯»åˆ°äº†è¿™é‡Œæˆ‘ç”±è¡·çš„èµå¹ä½ çš„è€å¿ƒå’Œæ±‚çŸ¥æ¬²å¹¶å¯¹ä½ è¡¨ç¤ºå‡ºå¤§å¤§çš„ğŸ‘ã€‚ä½†è¿˜æ²¡ç»“æŸï¼Œæˆ‘ä»¬ä¼¼ä¹å¿˜è®°äº†ä»€ä¹ˆï¼Ÿå“¦ï¼"},{"insert":{"blue700-tag":{"id":1763544347376,"text":"$state","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":"åˆ›å»ºçš„"},{"attributes":{"bold":true},"insert":"å“åº”å¼å˜é‡"},{"insert":"æ˜¯æ€ä¹ˆåœ¨è¢«è®¿é—®åˆ°çš„æ—¶å€™ï¼Œè®°å½•åŒæ–¹çš„ä¾èµ–è®¢é˜…å…³ç³»çš„ï¼Ÿ\n\nè¿½è¸ªè®°å½•ä¾èµ–è®¢é˜…å…³ç³»"},{"attributes":{"header":2},"insert":"\n"},{"insert":"ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡"},{"attributes":{"bold":true},"insert":"ä»£ç†ï¼ˆProxyï¼‰"},{"insert":"å®ç°äº†åŸºç¡€çš„"},{"insert":{"blue700-tag":{"id":1763544347376,"text":"$state","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":"ï¼Œç°åœ¨æˆ‘ä»¬ä»…éœ€åœ¨å®ƒé‡Œé¢æ–°å¢ä¸€ä¸¢ä¸¢é€»è¾‘ä¾¿å¯è½»æ¾å®ç°åŒæ–¹ä¾èµ–è®¢é˜…å…³ç³»çš„å»ºç«‹ï¼š\n// ./your-path/stateProxy.ts"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"import { getCurrentRunner } from \"./your-path/$effect\""},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"export function createStore<T extends object>(initial: T) {"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"  ......"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"  // notify all react subscribers (effect derived etc.)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  function notifyReactSubRun(reactSubs?: Set<RunnerType>) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"      reactSubs?.forEach(reactSub => {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        reactSub.__run()"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    });"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  }"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"  let targetSubs = new TargetSubs()"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"  function makeProxy(obj: any) {"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"    ......"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"    const proxy = new Proxy(obj, {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"      get(target, key, receiver) {"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"        ......"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"        const currentRunner = getCurrentRunner()"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"        // sync get current effect runner if it is running"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        if (currentRunner) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"          // add runner deps"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"          currentRunner.deps.add({"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            _subs: targetSubs.addSubsIfNeed(target, key, currentRunner)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"          })"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        }"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        "},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        ......"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"      },"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"      set(target, key, value, receiver) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        ......"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"        const subs = targetSubs.getSubs(obj, key)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        notifyReactSubRun(subs)"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"        ......"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"      }"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    "},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"      ......"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"    })"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"    ......"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  }"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"}"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"è¿™é‡Œä»…å±•ç¤ºå‡ºæ–°å¢çš„é€»è¾‘ã€‚åœ¨"},{"attributes":{"bold":true},"insert":"getè®¿é—®æ‹¦æˆªé‡Œ"},{"insert":"ï¼Œæˆ‘ä»¬åˆ¤æ–­å½“å‰å¤„åœ¨ effect ä¸Šä¸‹æ–‡ä¸­ï¼Œåˆ™é€šè¿‡ "},{"insert":{"blue700-tag":{"id":1763544693941,"text":"targetSubs.addSubsIfNeed","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" æ–¹æ³•æ¥è®°å½•è¿½è¸ªå½“å‰è®¢é˜…è€…ï¼ŒåŒæ—¶å‘ effect çš„ä¾èµ–åˆ—è¡¨ä¸­ä¸­åŠ å…¥"},{"attributes":{"bold":true},"insert":"ä»£è¡¨è‡ªèº«çš„ä¾èµ–é¡¹"},{"insert":"å®ƒæä¾›äº†è‡ªå·±å½“å‰çš„è®¢é˜…è€…åˆ—è¡¨ï¼Œeffect åœ¨æ¸…ç†å…³ç³»æ—¶å¯ä»¥å°†å®ƒè‡ªèº«ä»è¿™ä¸ªåˆ—è¡¨ä¸­ç§»é™¤ï¼‰ï¼Œè¿™å°±å®Œæˆäº†åŒæ–¹ä¾èµ–è®¢é˜…å…³ç³»çš„å»ºç«‹ã€‚\n\nè€Œåœ¨setèµ‹å€¼æ‹¦æˆªä¸­é€šè¿‡ "},{"insert":{"blue700-tag":{"id":1763544822050,"text":"targetSubs.getSubs","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" æ–¹æ³•å–å‡ºå½“å‰çš„è®¢é˜…è€…ï¼Œå¹¶é€šçŸ¥å®ƒä»¬ï¼Œè¿™é‡Œç›´æ¥è°ƒç”¨ effect æä¾›çš„ "},{"insert":{"blue700-tag":{"id":1763544818584,"text":"__run","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" æ–¹æ³•ã€‚\n\næœ€åæ˜¯æˆ‘ä»¬çš„ "},{"insert":{"blue700-tag":{"id":1763544890430,"text":"TargetSubs","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" ç±»ï¼Œå®ƒä¸“é—¨è¿½è¸ªè®°å½•æ¯ä¸ªè¢«è®¿é—®å¯¹è±¡çš„"},{"attributes":{"bold":true},"insert":"è®¢é˜…è€…"},{"insert":"ã€‚æˆ‘ä»¬ä¸ºè¿™ä¸ªè¿‡ç¨‹å•ç‹¬å®ç°äº†è¿™ä¸ªç±»ï¼š\nimport { RunnerType } from \"./your-path/$effect\""},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"export default class TargetSubs {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    // target -> prop map"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    private targetPropSubsMap = new WeakMap<object, Map<any, Set<RunnerType>>>()"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"    addSubsIfNeed(target: object, prop: any, sub: RunnerType) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        let targetMap = null"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        let targetPropSet = null"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"        if (!this.targetPropSubsMap.has(target)) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            targetPropSet = new Set([sub])"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            this.targetPropSubsMap.set(target,  new Map([[prop, targetPropSet]]))"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"            return targetPropSet"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        }"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"        targetMap = this.targetPropSubsMap.get(target)!"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"        if (!targetMap.has(prop)) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            targetPropSet = new Set([sub])"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            targetMap.set(prop, targetPropSet)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            console.log('[TargetSubs] [add] åˆå§‹åŒ– Prop Set', targetMap)"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"            return targetPropSet"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        }"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"        targetPropSet = targetMap.get(prop)!"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"        if (!targetPropSet.has(sub)) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"            targetPropSet.add(sub)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        }"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"        return targetPropSet"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"    getSubs(target: object, prop: any) {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"        return this.targetPropSubsMap.get(target)?.get(prop)"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"}"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"éœ€è¦éå¸¸æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ "},{"insert":{"blue700-tag":{"id":1763544693941,"text":"targetSubs.addSubsIfNeed","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" å’Œ "},{"insert":{"blue700-tag":{"id":1763544822050,"text":"targetSubs.getSubs","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" æ–¹æ³•æ—¶æä¾›çš„æä¾›çš„å‚æ•°ã€‚åœ¨å®ç°ä¸­ï¼Œæˆ‘ä»¬ä¸ºä»£ç†ï¼ˆProxyï¼‰ä¸­æ¯ä¸ª "},{"attributes":{"bold":true},"insert":"target"},{"insert":" çš„ "},{"attributes":{"bold":true},"insert":"prop "},{"insert":"å•ç‹¬åšäº†è®¢é˜…è€…è¿½è¸ªè®°å½•ï¼Œè¿™æ˜¯ä¸ºäº†é’ˆå¯¹æ¯ä¸ª "},{"attributes":{"bold":true},"insert":"prop "},{"insert":"çš„å˜åŒ–ï¼Œä¸ä¼šå½±å“"},{"attributes":{"bold":true},"insert":"åŒä¸€ä¸ªä»£ç†"},{"insert":"ä¸‹"},{"attributes":{"bold":true},"insert":"å…¶å®ƒå€¼"},{"insert":"çš„è®¢é˜…è€…ã€‚\n\nä½ çœ‹ï¼Œè¿™äº›å…¶å®æœ¬è´¨ä¸Šä»ç„¶æ˜¯ä¸€å¥—åŸºäºè§‚å¯Ÿè€…è®¢é˜…è€…æ¨¡å¼çš„ç³»ç»Ÿã€‚â€œé«˜ç«¯çš„é£Ÿæå¾€å¾€åªéœ€è¦æœ€ç®€å•çš„çƒ¹é¥ªæ–¹å¼â€ï¼Œå†åŠ ä¸Šæˆ‘ä»¬ç»†è…»çš„æ“ä½œï¼Œä¸€é“è¶³ä»¥è®©å‘³è•¾æŒç»­ä¸ºä¹‹ç–¯ç‹‚çš„ç¾å‘³ä½³è‚´è¯ç”Ÿäº†ï¼æ­¤æ—¶ç”±è¡·åœ°æ„Ÿè°¢ä½ èƒ½è€å¿ƒçš„è¯»åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ å·²æ”¶è·é¢‡ä¸°ï¼Œè¿™æ˜¯ä»£è¡¨ä¸‹ä¸€ä»£å‰ç«¯æ¡†æ¶çš„æ ¸å¿ƒè®¾è®¡ç†å¿µå’Œå®ç°æ€è·¯ï¼Œå½“ç„¶ä¸æ­¢äºæ­¤ï¼Œä»æœ‰è®¸å¤šå†…å®¹å€¼å¾—æˆ‘ä»¬å»æ¢ç´¢ï¼Œä½†ä½ å·²è¶…è¶Šäº†è®¸å¤šäººï¼Œèµ°åœ¨äº†å‰é¢ï¼Œä¸ºæ­¤æˆ‘ä»¬åŠ æ²¹é¼“æŒğŸ‘ğŸ‘ğŸ‘ã€‚\n\næ¥æ¥ä¸‹è¿˜æœ‰ä¸€ä¸ª "},{"attributes":{"bold":true},"insert":"React"},{"insert":" ä¸æ›¾æ‹¥æœ‰çš„ "},{"attributes":{"bold":true},"insert":"Vue"},{"insert":" å’Œå…¶å®ƒè¯­è¨€å´ç»å¸¸ç”¨åˆ°çš„ "},{"insert":{"blue700-tag":{"id":1763545085089,"text":"rune","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":"ï¼Œé‚£å°±æ˜¯"},{"attributes":{"bold":true},"insert":"è®¡ç®—å˜é‡"},{"insert":"ï¼Œé‚£ä¹ˆä¸‹æ¬¡ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ·±å…¥æ¢ç´¢å¹¶å°† "},{"insert":{"blue700-tag":{"id":1763545125222,"text":"$derived","renderAsBlock":false,"className":"blue700-tag"}}},{"insert":" å¸¦è¿› React ä¸–ç•Œï¼\n"}]}

const safeHtml = getSafeHtmlFromDelta(TestDeltaString)

const result = {
    content: safeHtml,
}

export default result;

